requirejs.config({baseUrl:"./resources/js",paths:{jquery:"jquery-3.6.0",mousetrap:"mousetrap.min",jscookie:"js.cookie"}});let activePreset,camera_ip="192.168.0.190",base_url="http://"+camera_ip+"/cgi-bin",defaults={ip:camera_ip,flip:0,mirror:0,invertcontrols:0,infinitypt:0,infinityzoom:0,infinityfocus:0,panspeed:8,zoomspeed:5,tiltspeed:8,focusspeed:5,autopaninterval:30},variables={arrowKeys:["up","down","left","right","esc"],numKeys:["1","2","3","4","5","6","7","8","9"],sliderKeys:["w","s","q","a"],sliderClasses:[".zoom.plus",".zoom.minus",".focus.plus",".focus.minus"],slideKeyNums:[1e3,0,1e3,0],actions:{up:function(){stop_autopan(),cam_pantilt(1,"up"),console.log("Panned up")},down:function(){stop_autopan(),cam_pantilt(1,"down"),console.log("Panned down")},left:function(){stop_autopan(),cam_pantilt(1,"left"),console.log("Panned left")},right:function(){stop_autopan(),cam_pantilt(1,"right"),console.log("Panned right")},esc:function(){"PTZ-Optics - Main"==document.title?(stop_autopan(),cam_pantilt(1,"home"),console.log("Reset pantilt")):document.getElementById("closeLink").click()}}},config=defaults;function delay(n){document.getElementById("wrapper").classList.add("transition"),setTimeout((function(){window.location=n}),500)}function transLeft(n){document.getElementById("wrapper").classList.add("activeRightTransition"),setTimeout((function(){window.location=n}),500)}function transRight(n){document.getElementById("wrapper").classList.add("activeLeftTransition"),setTimeout((function(){window.location=n}),500)}config.ip=camera_ip;let alreadyPanning=!1;function handleKeyEvent(n,e){"keydown"===n?"esc"===e?variables.actions.esc():variables.actions[e]():"keyup"===n&&cam_pantilt(1,"ptzstop")}function keybinds(){variables.arrowKeys.forEach((function(n){Mousetrap.bind(n,(function(e){e.repeat||handleKeyEvent("keydown",n)}),"keydown"),Mousetrap.bind(n,(function(e){handleKeyEvent("keyup",n)}),"keyup"),$(`#${n}`).on("mousedown",(function(e){stop_autopan(),"esc"===n?(cam_pantilt(1,"home"),console.log("Reset pantilt")):(cam_pantilt(1,n),console.log(`Panned ${n}`))})),$(`#${n}`).on("mouseup",(function(n){stop_autopan(),cam_pantilt(1,"ptzstop"),console.log("Stopped Panning")}))})),variables.numKeys.forEach((function(n){Mousetrap.bind(n,(function(e){$(`#pst${n}`).focus(),activePreset=$(`#pst${n}`).html(),stop_autopan(),cam_preset(1,n,"poscall"),console.log(`Called preset ${n}`),$("#camTitle").html(`Active Preset: ${activePreset}`)}))})),variables.sliderKeys.forEach((function(n,e){Mousetrap.bind(n,(function(e){e.repeat||(e.preventDefault(),stop_autopan(),"q"==n?(lerp(1e3,"#zoomSlider","up"),cam_zoom(1,"zoomin")):"a"==n?(lerp(0,"#zoomSlider","down"),cam_zoom(1,"zoomout")):"w"==n?(lerp(1e3,"#focusSlider","up"),cam_zoom(1,"focusin")):"s"==n&&(lerp(0,"#focusSlider","down"),cam_zoom(1,"focusout")))}),"keydown"),Mousetrap.bind(n,(function(e){stop_autopan(),e.preventDefault(),"q"==n?lerp(500,"#zoomSlider","down"):"a"==n?lerp(500,"#zoomSlider","up"):"w"==n?lerp(500,"#focusSlider","down"):"s"==n&&lerp(500,"#focusSlider","up"),cam_zoom(1,"zoomstop")}),"keyup")})),variables.sliderClasses.forEach((function(n,e){let o=n.split(".");$("body").on("mousedown",`.${o[1]}.plus`,(function(e){if(".zoom.plus"===n){if(cam_zoom(1,`${o[1]}in`),console.log(`${o[1]}ing in`),lerping)return void console.log("Error: Already Lerping");lerping||lerp(1e3,"#zoomSlider","up")}else if(".focus.plus"===n){if(cam_focus(1,`${o[1]}in`),console.log(`${o[1]}ing in`),lerping)return void console.log("Error: Already Lerping");lerping||lerp(1e3,"#focusSlider","up")}})),$("body").on("mouseup",`.${o[1]}.plus`,(function(e){if(".zoom.plus"===n){if(cam_zoom(1,"zoomstop"),console.log("stopped"),lerping)return void console.log("Error: Already Lerping");lerping||lerp(500,"#zoomSlider","down")}else if(".focus.plus"===n){if(cam_focus(1,"focusstop"),console.log("stopped"),lerping)return void console.log("Error: Already Lerping");lerping||lerp(500,"#focusSlider","down")}})),$("body").on("mousedown",`.${o[1]}.minus`,(function(e){if(".zoom.minus"===n){if(cam_zoom(1,`${o[1]}out`),console.log(`${o[1]}ing out`),lerping)return void console.log("Error: Already Lerping");lerping||lerp(1,"#zoomSlider","down")}else if(".focus.minus"===n){if(cam_focus(1,`${o[1]}out`),console.log(`${o[1]}ing out`),lerping)return void console.log("Error: Already Lerping");lerping||lerp(1,"#focusSlider","down")}})),$("body").on("mouseup",`.${o[1]}.minus`,(function(e){if(".zoom.minus"===n){if(cam_zoom(1,"zoomstop"),console.log("stopped"),lerping)return void console.log("Error: Already Lerping");lerping||lerp(500,"#zoomSlider","up")}else if(".focus.minus"===n){if(cam_focus(1,"focusstop"),console.log("stopped"),lerping)return void console.log("Error: Already Lerping");lerping||lerp(500,"#focusSlider","up")}}))}))}let lerping=!1,lerpCancelled=!1;const timer=n=>new Promise((e=>setTimeout(e,n)));async function lerp(n,e,o){let i=Number($(e).val());for(lerping=!0,lerpCancelled=!1;lerping;){if("up"===o)if(i<n)if(i<n-.8){i+=(n-i)/10,$(e).val(i)}else i=n;else lerping=!1;else if("down"===o)if(i>n)if(i>n+.8){i+=(n-i)/10,$(e).val(i)}else i=n;else lerping=!1;lerpCancelled&&(lerping=!1),await timer(5)}}function cancelLerp(){lerpCancelled=!0}function get_config(){let n=localStorage.getItem("configStorage");return n?JSON.parse(n):config}function save_config(){localStorage.setItem("configStorage",JSON.stringify(config)),console.log(config)}function run_action(n){$.ajax({url:n,type:"GET"}).done((function(){})).fail((function(n,e,o){console.log("error")})).always((function(){}))}function config_init(){config=get_config(),console.log(config),$("#cameraIP").val(config.ip),base_url="http://"+config.ip+"/cgi-bin",config_setting("flip",config.flip),config_setting("mirror",config.mirror),config_setting("invertcontrols",config.invertcontrols),config_setting("infinitypt",config.infinitypt),config_setting("infinityzoom",config.infinityzoom),config_setting("infinityfocus",config.infinityfocus),$("#panSpeed").val(config.panspeed),$("#zoomSpeed").val(config.zoomspeed),$("#tiltSpeed").val(config.tiltspeed),$("#focusSpeed").val(config.focusspeed),$("#panInterval").val(config.autopaninterval),1==config.infinitypt?$("#infPT").html("Infinity Pan/Tilt - Yes"):$("#infPT").html("Infinity Pan/Tilt - No"),1==config.infinityzoom?($("#cam_zoom_infinity").show(),$("#cam_zoom_standard").hide()):($("#cam_zoom_infinity").hide(),$("#cam_zoom_standard").show()),1==config.infinityfocus?($("#cam_focus_infinity").show(),$("#cam_focus_standard").hide()):($("#cam_focus_infinity").hide(),$("#cam_focus_standard").show()),update_labels()}function config_setting(n,e){run_action(base_url+"/param.cgi?post_image_value&"+n+"&"+e)}function update_labels(){switch(config.flip){case 0:$("#flip").html("Flip - No");break;case 1:$("#flip").html("Flip - Yes")}switch(config.mirror){case 0:$("#mirror").html("Mirror - No");break;case 1:$("#mirror").html("Mirror - Yes")}switch(config.invertcontrols){case 0:$("#invertcontrols").html("Invert Controls - No");break;case 1:$("#invertcontrols").html("Invert Controls - Yes")}switch(config.infinitypt){case 0:$("#infinitypt").html("Infinity Pan/Tilt-No");break;case 1:$("#infinitypt").html("Infinity Pan/Tilt-Yes")}switch(config.infinityzoom){case 0:$("#infinityzoom").html("Infinity Zoom-No");break;case 1:$("#infinityzoom").html("Infinity Zoom-Yes")}switch(config.infinityfocus){case 0:$("#infinityfocus").html("Infinity Focus-No");break;case 1:$("#infinityfocus").html("Infinity Focus-Yes")}config.ip=$("#cameraIP").val()}function reload_cam(){let n=$("#cameraIP").val();/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(n)?(config.ip=n,save_config(),alert("New IP address saved.")):alert("IP address entered is invalid! Please re-enter the camera IP address.")}function adjust_setting(n){let e,o;switch(n){case"flip":e=0===config.flip?base_url+"/param.cgi?post_image_value&flip&1":base_url+"/param.cgi?post_image_value&flip&0",run_action(e),config.flip=0===config.flip?1:0;break;case"mirror":o=0===config.mirror?base_url+"/param.cgi?post_image_value&mirror&1":base_url+"/param.cgi?post_image_value&mirror&0",run_action(o),config.mirror=0===config.mirror?1:0;break;case"invertcontrols":config.invertcontrols=0===config.invertcontrols?1:0;break;case"infinitypt":config.infinitypt=0===config.infinitypt?1:0,$("#pt_infinity").toggle();break;case"infinityzoom":config.infinityzoom=0===config.infinityzoom?1:0,$("#cam_zoom_infinity").toggle(),$("#cam_zoom_standard").toggle();break;case"infinityfocus":config.infinityfocus=0===config.infinityfocus?1:0,$("#cam_focus_infinity").toggle(),$("#cam_focus_standard").toggle()}save_config(),update_labels()}function update_settings(){0===config.flip?run_action(`${base_url}/param.cgi?post_image_value&flip&0`):1===config.flip&&run_action(`${base_url}/param.cgi?post_image_value&flip&1`),0===config.mirror?run_action(`${base_url}/param.cgi?post_image_value&mirror&0`):1===config.mirror&&run_action(`${base_url}/param.cgi?post_image_value&mirror&1`),0===config.infinitypt?$("#pt_infinity").hide():1===config.infinitypt&&$("#pt_infinity").show(),0===config.infinityzoom?($("#cam_zoom_infinity").hide(),$("#cam_zoom_standard").show()):1===config.infinityzoom&&($("#cam_zoom_infinity").show(),$("#cam_zoom_standard").hide()),1===config.infinityfocus?($("#cam_focus_infinity").hide(),$("#cam_focus_standard").show()):0===config.infinityfocus&&($("#cam_focus_infinity").show(),$("#cam_focus_standard").hide()),update_labels()}function cam_pantilt(n,e){const o=getDirection(e);run_action(`${base_url}/ptzctrl.cgi?ptzcmd&${o}&${config.panspeed}&${config.tiltspeed}`)}function getDirection(n){if("1"===config.invertcontrols)switch(n){case"left":return"right";case"right":return"left";case"up":return"down";case"down":return"up";default:return n}return n}function cam_zoom(n,e){run_action(`${base_url}/ptzctrl.cgi?ptzcmd&${e}&${config.zoomspeed}`)}function cam_focus(n,e){run_action(`${base_url}/ptzctrl.cgi?ptzcmd&${e}&${config.focusspeed}`)}function cam_preset(n,e,o){run_action(`${base_url}/ptzctrl.cgi?ptzcmd&${o}&${e}`)}let autoInterval,panInterval,panning,autopanning=!1;function autopan(){var n=config.autopaninterval;autopanning=!0,cam_preset(1,11,"poscall"),setTimeout((function(){console.log("start panning right"),pan("right"),autoInterval=setInterval((function(){"left"==panning?(clearInterval(panInterval),console.log("start panning right"),pan("right")):"right"==panning&&(clearInterval(panInterval),console.log("start panning left"),pan("left"))}),1e3*n)}),1e3)}function pan(n){panInterval=setInterval((function(){if("left"==n){if(panning="left","1"==config.invertcontrols)var e=base_url+"/ptzctrl.cgi?ptzcmd&right&10&10";else e=base_url+"/ptzctrl.cgi?ptzcmd&left&10&10";console.log("...pan left")}else if("right"==n){if(panning="right","1"==config.invertcontrols)e=base_url+"/ptzctrl.cgi?ptzcmd&left&10&10";else e=base_url+"/ptzctrl.cgi?ptzcmd&right&10&10";console.log("...pan right")}run_action(e)}),1e3)}function stop_autopan(){autoInterval&&clearInterval(autoInterval),panInterval&&clearInterval(panInterval),autopanning=!1,$("#panBtn").removeClass("pressed"),cam_pantilt(1,"ptzstop"),$(".autopan").removeClass("active")}requirejs(["jquery","mousetrap","jscookie"],(function(n,e,o){window.keybinds=keybinds,window.lerp=lerp,window.get_config=get_config,window.save_config=save_config,window.run_action=run_action,window.config_init=config_init,window.config_setting=config_setting,window.update_labels=update_labels,window.reload_cam=reload_cam,window.adjust_setting=adjust_setting,window.update_settings=update_settings,window.cam_pantilt=cam_pantilt,window.cam_zoom=cam_zoom,window.cam_focus=cam_focus,window.cam_preset=cam_preset,config_init(),keybinds(),o.get("theme")||(document.cookie="theme = light; expires=Fri, 01 Jan 2100 00:00:00 UTC;"),document.documentElement.setAttribute("data-theme",o.get("theme")),n("#themeToggle").click((function(){var n=o.get("theme");"light"===n?document.cookie="theme = dark; expires=Fri, 01 Jan 2100 00:00:00 UTC;":"dark"===n&&(document.cookie="theme = light; expires=Fri, 01 Jan 2100 00:00:00 UTC;"),document.documentElement.setAttribute("data-theme",o.get("theme"))})),n("#parent-element").on("mousedown",(function(n){let e=n.target.id;variables.arrowKeys.includes(e)&&variables.actions[e]()})),n("#parent-element").on("mouseup",(function(n){cam_pantilt(1,"ptzstop"),console.log("Stopped Panning")})),n("#rightLink").on("mouseover",(function(){n("#wrapper").addClass("rightTransition")})),n("#rightLink").on("mouseout",(function(){n("#wrapper").removeClass("rightTransition")})),n("#leftLink").on("mouseover",(function(){n("#wrapper").addClass("leftTransition")})),n("#leftLink").on("mouseout",(function(){n("#wrapper").removeClass("leftTransition")})),n(".btn").click((function(e){activePreset=n(this).html(),stop_autopan(),cam_preset(1,activePreset,"poscall"),console.log(`Called preset ${activePreset}`),n("#camTitle").html(`Active Preset: ${o.get(`${activePreset}`)}`)})),n(".btn").on("mouseout",(function(e){let i=activePreset;void 0===activePreset?n("#camTitle").html("Active Preset: No Preset Active"):n("#camTitle").html(`Active Preset: ${o.get(`${i}`)}`),n("#presetTitle1").html("Presets")})),n(".btn").on("mouseover",(function(e){let i=n(this).html();n("#camTitle").html(`Preset Preview: ${o.get(`${i}`)}`),n("#presetTitle1").html(`${o.get(`${i}`)}`)})),n("#infoLink").click((function(e){n("#about").toggleClass("show")})),n(".asgnBtn").click((function(e){pstNum=n(this).html(),pstNum<11?(cam_preset(1,pstNum,"posset"),console.log(`Set preset ${pstNum}`)):(cam_preset(1,11,"posset"),console.log("Set autopan start position"));let o=prompt("Enter a name for the preset:");document.cookie=`${pstNum} = ${o}; expires=Fri, 01 Jan 2100 00:00:00 UTC;`})),n("body").on("click","#panBtn",(function(e){return e.preventDefault(),n(this).toggleClass("pressed"),cam_pantilt(1,"ptzstop"),0==autopanning?(autopan(),n(this).addClass("active")):stop_autopan(),!1})),n("#clearBtn").click((function(n){n.preventDefault(),confirm("Are you sure you want to delete all presets (This cannot be undone!)")?console.log("deleted"):console.log("canceled")})),n("body").on("click",".adjust_setting",(function(n){return n.preventDefault(),adjust_setting(this.id),!1})),n("body").on("change","select",(function(e){e.preventDefault();var o=n(this).attr("id");return config[o]=n(this).val(),save_config(),!1}))}));